server {
    listen 8406;                    # Mendengarkan di semua interface (0.0.0.0:8406)
    # listen [::]:8406;             # Uncomment jika ingin support IPv6 juga
    server_name alphaka localhost 127.0.0.1;   # Tambah localhost & IP agar lebih fleksibel

    # Logging (sangat membantu untuk debug)
    access_log /var/log/nginx/jenkins_access.log;
    error_log  /var/log/nginx/jenkins_error.log warn;

    # Timeout yang lebih panjang (Jenkins sering butuh waktu lama)
    proxy_read_timeout          300;
    proxy_connect_timeout       300;
    proxy_send_timeout          300;

    # Lokasi utama â†’ langsung ke Jenkins root[](http://alphaka:8406)
    location / {
        proxy_pass                  http://127.0.0.1:8080/;
        proxy_redirect              default;

        # Header penting untuk reverse proxy Jenkins
        proxy_set_header            Host                $http_host;
        proxy_set_header            X-Real-IP           $remote_addr;
        proxy_set_header            X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header            X-Forwarded-Proto   $scheme;
        proxy_set_header            X-Forwarded-Host    $host;
        proxy_set_header            X-Forwarded-Port    $server_port;

        # Support WebSocket (penting untuk Jenkins agent & Blue Ocean)
        proxy_http_version          1.1;
        proxy_set_header            Upgrade             $http_upgrade;
        proxy_set_header            Connection          "upgrade";

        # Biar URL tidak rusak
        proxy_redirect              http://localhost:8080/  /;
        proxy_redirect              http://127.0.0.1:8080/   /;
    }

    # Blokir akses ke file sensitif
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }

    # Opsional: Blokir akses ke file konfigurasi Jenkins
    location ~* \.(xml|war|config|properties|yml|yaml|log)$ {
        deny all;
    }

    # Opsional: Jika ingin tambah cache untuk static files Jenkins (mempercepat)
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|woff|woff2|ttf|svg|eot)$ {
        expires 30d;
        access_log off;
        add_header Cache-Control "public";
    }
}
